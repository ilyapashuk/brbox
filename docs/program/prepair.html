<html><body>
<h1>команда prepair</h1>
<p>использование: brbox prepair infile.txt outfile.bxt
<h2>конфиг субкоманды</h2>
<p>перед началом работы считывается файл prepair.script из конфигурационного каталога утилиты. <br />
<p>обработка файла происходит при помощи обработчиков - специальных подпрограмм, совершающих различные действия с текстом файла, при этом каждый следующий обработчик получает результат работы предыдущего, первый получает неизменённый текст исходного файла, а результат работы последнего оказывается в выходном файле.
<p>в конфигфайле указан список обработчиков, которые последовательно применяются к тексту. обработчикам можно передавать аргументы, порядок имеет значение.
<p>также в приложение встроен <a href="https://github.com/dop251/goja">javascript-движок</a>, позволяющий писать на js простые обработчики.
<p>вот список имеющихся сейчас обработчиков:
<ul>
<li>dropchr: убирает из текста все вхождения переданных символов. например, команда "dropchr abc" уберёт все символы a b c из текста
<li>once: если в тексте встречается непрерывная последовательность, состоящая из одного и того же многократно повторяющегося символа, и этот символ содержится в аргументе, то последовательность сокращается до одного такого символа. например, если этому обработчику передать символ пробела, то в тексте строка "a b &nbsp;c d" превратится в "a b c d"
<li>replace: заменяет все вхождения переданной подстроки на подстроку замены. например, если команду "replace p b" применить к тексту "papa", то на выходе получим "baba" <br />
одной команде можно передать несколько пар аргументов
<li>replacefile: то же самое, что и replace, но аргументом должно быть имя файла, из которого будут считаны пары для замены, разделителем аргументов должен быть символ перевода строки
<li>treplace и treplacefile: то же, что replace, но замена происходит не строки на строку, а строки на брайлевский символ. <br />
то есть, вызов "treplace [ 12356" заменит левую квадратную скобку на символ, который в таблице bxt соответствует точкам 12356. <br />
можно передать несколько брайлевских знаков, разделив их пробелом. также можно вставить в последовательность обычный символ, используя цифру 0. <br />
например, вот так можно обеспечить корректное написание символа процента: "treplace % '3456 0%'"
<li>noblank: убирает из текста пустые строки, а также строки, состоящие из одних только пробелов
<li>commaspace: убирает пробелы после запятых
<li>numsign: проставляет цифровые знаки перед числами. если сразу после числа следует символ, который по таблице имеет то же представление, что и последняя цифра, например, цифра 3 и буква c, то во избежание путаницы между последней цифрой и этим символом вставляется 6-я точка.
<li>quotes: проставляет символ процента в качестве закрывающей ковычки. обратите внимание, что обработчик ожидает, что в тексте будут обычные, набираемые по shift+2, ковычки, а не современные символы. современные символы должны быть перед запуском обработчика заменены на обычные ковычки.
<li>buni: бэктранслирует символы брайлевского юникода, если они находятся в тексте, в соответствующие символы таблицы bxt, так чтобы они потом были корректно отображены на брайлевском дисплее и транслированы в какой-то из общепринятых форматов для печати. в результате вызова этого обработчика длина текста и его строк никогда не изменяется.
<li>linewrap: расставляет в тексте переносы так, чтобы ни одна из его строк не превышала длины брайлевской строки, заданной в конфиге. принимает один аргумент, который должен быть либо 1, либо 0. если 1, то для переноса слов используется библиотека hyphenation, иначе работает простой перенос по словам. нужная длина строк задаётся переменной BRBOX_LINE_SIZE конфига. <br />
внимание: если после этого обработчика будет вызван обработчик, увеличивающий длину каких-либо частей текста, то в выходном файле условие длины строк может не быть соблюдено.
<li>tableonly: заменяет брайлевским шеститочием все символы, неизвестные таблице. обычно вызывается последним, длину текста и его частей никогда не изменяет.
<li>script и scriptfile: применяет к тексту javascript-обработчик <br />
команда script может быть использована для действий, которые можно записать в виде однострочного выражения, иначе нужно использовать scriptfile. <br />
<a href=jsapi.html>документация по api</a>
</ul>
<p>также вы можете добавлять свои обработчики на js. <br />
для этого поместите их в подкаталог prepair.handlers каталога конфигурации.
<p>имя обработчика будет таким же, как имя его js-файла без расширения.
<p>api, доступное обработчику в этом режиме, не отличается от вызова обработчиков при помощи script и scriptfile, но добавляется переменная opts для аргументов.
<p>обычно использование данного режима предпочтительнее, чем использование обработчиков script и scriptfile, поскольку считывание и парсинг файла скрипта осуществляются только при первом вызове обработчика, что может дать прирост производительности при многократном его использовании в рамках одной сессии.
</body></html>